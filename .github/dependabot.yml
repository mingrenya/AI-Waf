version: 2
updates:
  # ===========================================
  # Go ä¾èµ–æ›´æ–° - ä¿æŒé€‚åº¦æ›´æ–°ç­–ç•¥
  # ===========================================
  - package-ecosystem: "gomod"
    directories:
      - "/server"
      - "/pkg"
      - "/coraza-spoa"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "08:00"
      timezone: "Asia/Shanghai"
    open-pull-requests-limit: 8 # ç•¥å¾®é™ä½é™åˆ¶
    labels:
      - "dependencies"
      - "go"
      - "backend"
    commit-message:
      prefix: "chore"
      include: "scope"

    groups:
      # Go å°ç‰ˆæœ¬å’Œè¡¥ä¸æ›´æ–° - ç›¸å¯¹å®‰å…¨
      go-minor-patch:
        applies-to: version-updates
        patterns: ["*"]
        update-types: ["minor", "patch"]

      # å®‰å…¨æ›´æ–° - é«˜ä¼˜å…ˆçº§
      go-security:
        applies-to: security-updates
        patterns: ["*"]

    ignore:
      # åªå¿½ç•¥ä¸»ç‰ˆæœ¬æ›´æ–°ï¼Œå…è®¸å°ç‰ˆæœ¬å’Œè¡¥ä¸
      - dependency-name: "*"
        update-types: ["version-update:semver-major"]

  # ===========================================
  # GitHub Actions æ›´æ–° - ä¿æŒç°æœ‰ç­–ç•¥
  # ===========================================
  - package-ecosystem: "github-actions"
    directory: "/"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "08:00"
      timezone: "Asia/Shanghai"
    open-pull-requests-limit: 4 # ç•¥å¾®é™ä½
    labels:
      - "dependencies"
      - "github-actions"
      - "ci"
    commit-message:
      prefix: "ci"
      include: "scope"

    groups:
      github-actions-all:
        patterns: ["*"]
        update-types: ["minor", "patch"]

    ignore:
      # åªå¿½ç•¥ä¸»ç‰ˆæœ¬æ›´æ–°
      - dependency-name: "*"
        update-types: ["version-update:semver-major"]

  # ===========================================
  # Docker åŸºç¡€é•œåƒæ›´æ–° - ä¿å®ˆç­–ç•¥
  # ===========================================
  - package-ecosystem: "docker"
    directory: "/"
    schedule:
      interval: "weekly"
      day: "monday"
      time: "08:00"
      timezone: "Asia/Shanghai"
    open-pull-requests-limit: 3 # é™ä½é™åˆ¶
    labels:
      - "dependencies"
      - "docker"
      - "infrastructure"
    commit-message:
      prefix: "docker"
      include: "scope"

    groups:
      docker-minor-patch:
        patterns: ["*"]
        update-types: ["minor", "patch"]

    ignore:
      # å¿½ç•¥ä¸»ç‰ˆæœ¬æ›´æ–°
      - dependency-name: "*"
        update-types: ["version-update:semver-major"]

      # ===== ç‰¹å®šç‰ˆæœ¬é”å®š =====
      # é”å®š HAProxy ç‰ˆæœ¬ - ç¡®ä¿ WAF åŠŸèƒ½ç¨³å®š
      - dependency-name: "haproxy"
        versions: [">3.0.10"]

      # é”å®š Golang æ„å»ºç‰ˆæœ¬ - ç¡®ä¿åç«¯æ„å»ºç¯å¢ƒä¸€è‡´æ€§
      - dependency-name: "golang"
        versions: [">1.24.1"]

      # é”å®šåŸºç¡€é•œåƒçš„ä¸»ç‰ˆæœ¬
      - dependency-name: "node"
        versions: [">22.0.0"] # å¦‚æœå½“å‰ä½¿ç”¨ Node 20.xï¼Œä¸è‡ªåŠ¨å‡çº§åˆ° 22.x
      - dependency-name: "alpine"
        versions: [">3.20.0"] # ä¿æŒ Alpine ç‰ˆæœ¬ç¨³å®š


  # ===========================================
  # Dockerfile å¤šé˜¶æ®µæ„å»ºçš„å…¶ä»–é…ç½®
  # ===========================================

  # å¦‚æœæœ‰å…¶ä»– package managers (å¦‚ pip, maven ç­‰)
  # å¯ä»¥åœ¨è¿™é‡Œæ·»åŠ ç±»ä¼¼çš„ä¿å®ˆé…ç½®

  # ç¤ºä¾‹ï¼šå¦‚æœé¡¹ç›®ä¸­æœ‰ Python ä¾èµ–
  # - package-ecosystem: "pip"
  #   directory: "/scripts"  # å¦‚æœæœ‰ Python è„šæœ¬ç›®å½•
  #   schedule:
  #     interval: "monthly"
  #   open-pull-requests-limit: 2
  #   labels:
  #     - "dependencies"
  #     - "python"
  #     - "scripts"
  #   ignore:
  #     - dependency-name: "*"
  #       update-types: ["version-update:semver-major", "version-update:semver-minor"]
# ===========================================
# å…¨å±€é…ç½®è¯´æ˜
# ===========================================
#
# ğŸ¯ ç­–ç•¥æ€»ç»“ï¼š
#
# å‰ç«¯ (npm): ä¸æ›´æ–°
#
# åç«¯ (Go): é€‚åº¦æ›´æ–°
# - å‘¨åº¦æ£€æŸ¥ï¼Œæœ€å¤š 8 ä¸ª PR
# - å…è®¸å°ç‰ˆæœ¬å’Œè¡¥ä¸æ›´æ–°
# - åªç¦æ­¢ä¸»ç‰ˆæœ¬æ›´æ–°
#
# CI/CD: ä¿å®ˆæ›´æ–°
# - GitHub Actions å…è®¸å°ç‰ˆæœ¬æ›´æ–°
# - Docker é•œåƒä¿å®ˆæ›´æ–°ï¼Œé”å®šå…³é”®ç‰ˆæœ¬
#
# ğŸ”§ æ‰‹åŠ¨æ›´æ–°æµç¨‹ï¼š
#
# 1. å‰ç«¯å…³é”®ä¾èµ–éœ€è¦å­£åº¦è¯„ä¼°
# 2. åœ¨ä¸“é—¨çš„åˆ†æ”¯ä¸­æµ‹è¯•æ›´æ–°
# 3. å……åˆ†æµ‹è¯•åå†åˆå¹¶
# 4. ä¿æŒè¯¦ç»†çš„æ›´æ–°æ—¥å¿—
