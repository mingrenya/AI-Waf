# .github/workflows/frontend-quality-check.yml (å®‰å…¨ä¿®å¤ç‰ˆæœ¬)
name: Frontend Code Quality Check

# ğŸ”’ å·¥ä½œæµçº§æƒé™æ§åˆ¶
permissions:
  contents: read
  pull-requests: write
  issues: write
  actions: read

on:
  pull_request:
    branches: [main, master, develop]
    paths:
      - "web/**"
      - "*.json"
      - "*.js"
      - "*.ts"
      - "*.tsx"
      - "*.vue"
      - "*.jsx"
  # ä¸“é—¨ç”¨äº PR è¯„è®ºçš„è§¦å‘å™¨
  pull_request_target:
    types: [opened, synchronize, reopened]
    branches: [main, master, develop]
  push:
    branches: [main, master, develop]
    paths:
      - "web/**"
      - "*.json"
      - "*.js"
      - "*.ts"
      - "*.tsx"
      - "*.vue"
      - "*.jsx"
  workflow_dispatch:

jobs:
  # ä¸»è¦çš„ CI æ£€æŸ¥ jobï¼ˆä½¿ç”¨ pull_requestï¼Œå®‰å…¨æ‰§è¡Œå¤–éƒ¨ä»£ç ï¼‰
  frontend-check:
    name: Frontend Code Quality Check
    runs-on: ubuntu-latest
    # åªåœ¨ pull_request å’Œ push äº‹ä»¶æ—¶è¿è¡Œï¼Œä¸åœ¨ pull_request_target æ—¶è¿è¡Œ
    if: github.event_name != 'pull_request_target'

    outputs:
      frontend-exists: ${{ steps.check-frontend.outputs.exists }}
      framework: ${{ steps.analyze-config.outputs.framework }}
      is-typescript: ${{ steps.analyze-config.outputs.is_typescript }}
      has-lint: ${{ steps.analyze-config.outputs.has_lint }}
      has-test: ${{ steps.analyze-config.outputs.has_test }}
      has-build: ${{ steps.analyze-config.outputs.has_build }}
      lint-status: ${{ steps.set-status.outputs.lint_status }}
      typecheck-status: ${{ steps.set-status.outputs.typecheck_status }}
      test-status: ${{ steps.set-status.outputs.test_status }}
      build-status: ${{ steps.set-status.outputs.build_status }}

    steps:
      # âœ… ä½¿ç”¨å®˜æ–¹æ¨èçš„æœ€æ–°ç¨³å®šç‰ˆæœ¬
      - name: Checkout code
        uses: actions/checkout@v4

      - name: Check frontend project
        id: check-frontend
        run: |
          if [ -d "web" ] && [ -f "web/package.json" ]; then
            echo "âœ… å‘ç°å‰ç«¯é¡¹ç›®"
            echo "exists=true" >> $GITHUB_OUTPUT
            echo "FRONTEND_EXISTS=true" >> $GITHUB_ENV
          else
            echo "â„¹ï¸ æœªå‘ç°å‰ç«¯é¡¹ç›®ï¼Œè·³è¿‡å‰ç«¯æ£€æŸ¥"
            echo "exists=false" >> $GITHUB_OUTPUT
            echo "FRONTEND_EXISTS=false" >> $GITHUB_ENV
          fi

      - name: Setup Node.js
        if: steps.check-frontend.outputs.exists == 'true'
        uses: actions/setup-node@v4
        with:
          node-version: "23.10.0"

      - name: Install pnpm
        if: steps.check-frontend.outputs.exists == 'true'
        uses: pnpm/action-setup@v4
        with:
          version: 10.11.0

      - name: Get pnpm store directory
        if: steps.check-frontend.outputs.exists == 'true'
        id: pnpm-cache
        shell: bash
        run: |
          echo "STORE_PATH=$(pnpm store path)" >> $GITHUB_OUTPUT

      # âœ… ä½¿ç”¨ v4 - å®˜æ–¹æ¨èçš„ç¨³å®šç‰ˆæœ¬
      - name: Setup pnpm cache
        if: steps.check-frontend.outputs.exists == 'true'
        uses: actions/cache@v4
        with:
          path: ${{ steps.pnpm-cache.outputs.STORE_PATH }}
          key: ${{ runner.os }}-pnpm-store-${{ hashFiles('**/pnpm-lock.yaml') }}
          restore-keys: |
            ${{ runner.os }}-pnpm-store-

      - name: Analyze project configuration
        if: steps.check-frontend.outputs.exists == 'true'
        id: analyze-config
        run: |
          cd web
          echo "ğŸ” åˆ†æå‰ç«¯é¡¹ç›®é…ç½®..."

          # æ£€æŸ¥package.jsonä¸­çš„è„šæœ¬
          if grep -q '"lint"' package.json; then
            echo "âœ… å‘ç° lint è„šæœ¬"
            echo "has_lint=true" >> $GITHUB_OUTPUT
          else
            echo "âš ï¸ æœªé…ç½® lint è„šæœ¬"
            echo "has_lint=false" >> $GITHUB_OUTPUT
          fi

          if grep -q '"test"' package.json; then
            echo "âœ… å‘ç° test è„šæœ¬"
            echo "has_test=true" >> $GITHUB_OUTPUT
          else
            echo "âš ï¸ æœªé…ç½® test è„šæœ¬"
            echo "has_test=false" >> $GITHUB_OUTPUT
          fi

          if grep -q '"build"' package.json; then
            echo "âœ… å‘ç° build è„šæœ¬"
            echo "has_build=true" >> $GITHUB_OUTPUT
          else
            echo "âš ï¸ æœªé…ç½® build è„šæœ¬"
            echo "has_build=false" >> $GITHUB_OUTPUT
          fi

          # æ£€æŸ¥TypeScripté…ç½®
          if [ -f "tsconfig.json" ]; then
            echo "âœ… å‘ç° TypeScript é¡¹ç›®"
            echo "is_typescript=true" >> $GITHUB_OUTPUT
          else
            echo "â„¹ï¸ é TypeScript é¡¹ç›®"
            echo "is_typescript=false" >> $GITHUB_OUTPUT
          fi

          # æ£€æŸ¥æ¡†æ¶ç±»å‹
          if grep -q '"vue"' package.json; then
            echo "ğŸ“¦ æ£€æµ‹åˆ° Vue.js é¡¹ç›®"
            echo "framework=vue" >> $GITHUB_OUTPUT
          elif grep -q '"react"' package.json; then
            echo "ğŸ“¦ æ£€æµ‹åˆ° React é¡¹ç›®"
            echo "framework=react" >> $GITHUB_OUTPUT
          elif grep -q '"next"' package.json; then
            echo "ğŸ“¦ æ£€æµ‹åˆ° Next.js é¡¹ç›®"
            echo "framework=nextjs" >> $GITHUB_OUTPUT
          else
            echo "ğŸ“¦ æ™®é€š JavaScript é¡¹ç›®"
            echo "framework=vanilla" >> $GITHUB_OUTPUT
          fi

      - name: Install dependencies
        if: steps.check-frontend.outputs.exists == 'true'
        run: |
          cd web
          echo "ğŸ“¦ å®‰è£…å‰ç«¯ä¾èµ–..."
          # ğŸ”’ ä½¿ç”¨ --frozen-lockfile ç¡®ä¿ä¾èµ–ä¸€è‡´æ€§
          pnpm install --frozen-lockfile
          echo "âœ… ä¾èµ–å®‰è£…å®Œæˆ"

      # è¿è¡Œ ESLint
      - name: Run ESLint
        if: steps.check-frontend.outputs.exists == 'true' && steps.analyze-config.outputs.has_lint == 'true'
        run: |
          cd web
          echo "ğŸ” è¿è¡Œ ESLint ä»£ç æ£€æŸ¥..."
          if pnpm lint; then
            echo "âœ… ESLint æ£€æŸ¥é€šè¿‡"
            echo "LINT_STATUS=success" >> $GITHUB_ENV
          else
            echo "âŒ ESLint æ£€æŸ¥å¤±è´¥"
            echo "LINT_STATUS=failed" >> $GITHUB_ENV
            exit 1
          fi

      - name: Skip ESLint (not configured)
        if: steps.check-frontend.outputs.exists == 'true' && steps.analyze-config.outputs.has_lint == 'false'
        run: |
          echo "âš ï¸ é¡¹ç›®æœªé…ç½® ESLintï¼Œè·³è¿‡ä»£ç æ£€æŸ¥"
          echo "LINT_STATUS=skipped" >> $GITHUB_ENV

      # è¿è¡Œ TypeScript ç±»å‹æ£€æŸ¥
      - name: Run TypeScript check
        if: steps.check-frontend.outputs.exists == 'true' && steps.analyze-config.outputs.is_typescript == 'true'
        run: |
          cd web
          echo "ğŸ” è¿è¡Œ TypeScript ç±»å‹æ£€æŸ¥..."
          if pnpm tsc --noEmit; then
            echo "âœ… TypeScript ç±»å‹æ£€æŸ¥é€šè¿‡"
            echo "TYPECHECK_STATUS=success" >> $GITHUB_ENV
          else
            echo "âŒ TypeScript ç±»å‹æ£€æŸ¥å¤±è´¥"
            echo "TYPECHECK_STATUS=failed" >> $GITHUB_ENV
            exit 1
          fi

      - name: Skip TypeScript check (not TypeScript project)
        if: steps.check-frontend.outputs.exists == 'true' && steps.analyze-config.outputs.is_typescript == 'false'
        run: |
          echo "â„¹ï¸ é TypeScript é¡¹ç›®ï¼Œè·³è¿‡ç±»å‹æ£€æŸ¥"
          echo "TYPECHECK_STATUS=skipped" >> $GITHUB_ENV

      # è¿è¡Œæµ‹è¯•
      - name: Run tests
        if: steps.check-frontend.outputs.exists == 'true' && steps.analyze-config.outputs.has_test == 'true'
        run: |
          cd web
          echo "ğŸ§ª è¿è¡Œå‰ç«¯æµ‹è¯•..."
          if pnpm test --passWithNoTests; then
            echo "âœ… å‰ç«¯æµ‹è¯•é€šè¿‡"
            echo "TEST_STATUS=success" >> $GITHUB_ENV
          else
            echo "âŒ å‰ç«¯æµ‹è¯•å¤±è´¥"
            echo "TEST_STATUS=failed" >> $GITHUB_ENV
            exit 1
          fi

      - name: Skip tests (not configured)
        if: steps.check-frontend.outputs.exists == 'true' && steps.analyze-config.outputs.has_test == 'false'
        run: |
          echo "âš ï¸ é¡¹ç›®æœªé…ç½®æµ‹è¯•ï¼Œè·³è¿‡æµ‹è¯•"
          echo "TEST_STATUS=skipped" >> $GITHUB_ENV

      # æ£€æŸ¥æ„å»º
      - name: Test build
        if: steps.check-frontend.outputs.exists == 'true' && steps.analyze-config.outputs.has_build == 'true'
        run: |
          cd web
          echo "ğŸ—ï¸ æµ‹è¯•å‰ç«¯æ„å»º..."
          if pnpm build; then
            echo "âœ… å‰ç«¯æ„å»ºæˆåŠŸ"
            echo "BUILD_STATUS=success" >> $GITHUB_ENV
          else
            echo "âŒ å‰ç«¯æ„å»ºå¤±è´¥"
            echo "BUILD_STATUS=failed" >> $GITHUB_ENV
            exit 1
          fi

      - name: Skip build (not configured)
        if: steps.check-frontend.outputs.exists == 'true' && steps.analyze-config.outputs.has_build == 'false'
        run: |
          echo "âš ï¸ é¡¹ç›®æœªé…ç½®æ„å»ºè„šæœ¬ï¼Œè·³è¿‡æ„å»ºæµ‹è¯•"
          echo "BUILD_STATUS=skipped" >> $GITHUB_ENV

      # ğŸ“¤ è®¾ç½®è¾“å‡ºçŠ¶æ€ï¼ˆä¿®å¤VS Codeè­¦å‘Šï¼‰
      - name: Set job outputs
        id: set-status
        if: always()
        run: |
          echo "lint_status=${LINT_STATUS:-skipped}" >> $GITHUB_OUTPUT
          echo "typecheck_status=${TYPECHECK_STATUS:-skipped}" >> $GITHUB_OUTPUT
          echo "test_status=${TEST_STATUS:-skipped}" >> $GITHUB_OUTPUT
          echo "build_status=${BUILD_STATUS:-skipped}" >> $GITHUB_OUTPUT

      # ğŸ”’ å¯é€‰ï¼šå®‰å…¨å®¡è®¡æ­¥éª¤
      - name: Security Audit
        if: steps.check-frontend.outputs.exists == 'true'
        run: |
          cd web
          echo "ğŸ” è¿è¡Œå®‰å…¨å®¡è®¡..."
          # æ£€æŸ¥å·²çŸ¥æ¼æ´
          if command -v pnpm &> /dev/null; then
            pnpm audit --audit-level moderate || echo "âš ï¸ å‘ç°å®‰å…¨é—®é¢˜ï¼Œå»ºè®®æ£€æŸ¥"
          fi
        continue-on-error: true

      # ç”Ÿæˆæ£€æŸ¥æŠ¥å‘Š
      - name: Generate Frontend check summary
        if: always()
        run: |
          echo "## ğŸ¨ Frontend Code Quality Check Report" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY

          if [ "$FRONTEND_EXISTS" = "false" ]; then
            echo "### â„¹ï¸ Project Status" >> $GITHUB_STEP_SUMMARY
            echo "No frontend project found, skipping frontend code checks." >> $GITHUB_STEP_SUMMARY
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "If your frontend code is not in the \`web/\` directory, please adjust the workflow configuration." >> $GITHUB_STEP_SUMMARY
          else
            echo "### ğŸ“‹ Check Results" >> $GITHUB_STEP_SUMMARY
            echo "| Check Item | Status | Description |" >> $GITHUB_STEP_SUMMARY
            echo "|---------|------|------|" >> $GITHUB_STEP_SUMMARY
            
            # ESLintçŠ¶æ€
            case "$LINT_STATUS" in
              "success") echo "| Code Standards (ESLint) | âœ… Passed | Code meets standards |" >> $GITHUB_STEP_SUMMARY ;;
              "failed") echo "| Code Standards (ESLint) | âŒ Failed | Found code standard issues |" >> $GITHUB_STEP_SUMMARY ;;
              *) echo "| Code Standards (ESLint) | âš ï¸ Skipped | No lint script configured |" >> $GITHUB_STEP_SUMMARY ;;
            esac
            
            # TypeScriptçŠ¶æ€
            case "$TYPECHECK_STATUS" in
              "success") echo "| Type Check (TypeScript) | âœ… Passed | Type definitions correct |" >> $GITHUB_STEP_SUMMARY ;;
              "failed") echo "| Type Check (TypeScript) | âŒ Failed | Found type errors |" >> $GITHUB_STEP_SUMMARY ;;
              *) echo "| Type Check (TypeScript) | âš ï¸ Skipped | Not a TypeScript project |" >> $GITHUB_STEP_SUMMARY ;;
            esac
            
            # æµ‹è¯•çŠ¶æ€
            case "$TEST_STATUS" in
              "success") echo "| Unit Tests | âœ… Passed | All tests passed |" >> $GITHUB_STEP_SUMMARY ;;
              "failed") echo "| Unit Tests | âŒ Failed | Test cases failed |" >> $GITHUB_STEP_SUMMARY ;;
              *) echo "| Unit Tests | âš ï¸ Skipped | No test script configured |" >> $GITHUB_STEP_SUMMARY ;;
            esac
            
            # æ„å»ºçŠ¶æ€
            case "$BUILD_STATUS" in
              "success") echo "| Build Test | âœ… Passed | Build successful |" >> $GITHUB_STEP_SUMMARY ;;
              "failed") echo "| Build Test | âŒ Failed | Build process error |" >> $GITHUB_STEP_SUMMARY ;;
              *) echo "| Build Test | âš ï¸ Skipped | No build script configured |" >> $GITHUB_STEP_SUMMARY ;;
            esac
            
            echo "" >> $GITHUB_STEP_SUMMARY
            echo "### ğŸ“Š Project Information" >> $GITHUB_STEP_SUMMARY
            echo "- **Framework**: ${{ steps.analyze-config.outputs.framework }}" >> $GITHUB_STEP_SUMMARY
            echo "- **TypeScript**: ${{ steps.analyze-config.outputs.is_typescript == 'true' && 'âœ… Yes' || 'âŒ No' }}" >> $GITHUB_STEP_SUMMARY
            echo "- **Node.js Version**: 23.10.0" >> $GITHUB_STEP_SUMMARY
            echo "- **pnpm Version**: 10.11.0" >> $GITHUB_STEP_SUMMARY
          fi

          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### ğŸ“Š Runtime Information" >> $GITHUB_STEP_SUMMARY
          echo "- **Commit SHA**: \`${{ github.sha }}\`" >> $GITHUB_STEP_SUMMARY
          echo "- **Branch**: \`${{ github.ref_name }}\`" >> $GITHUB_STEP_SUMMARY
          echo "- **Triggered by**: @${{ github.actor }}" >> $GITHUB_STEP_SUMMARY
          echo "- **Check Time**: $(date '+%Y-%m-%d %H:%M:%S UTC')" >> $GITHUB_STEP_SUMMARY

  # ğŸ”’ å®‰å…¨çš„ PR è¯„è®º jobï¼ˆä½¿ç”¨ pull_request_targetï¼Œä½†ä¸ checkout å¤–éƒ¨ä»£ç ï¼‰
  pr-comment:
    name: PR Comment Handler
    runs-on: ubuntu-latest
    # åªåœ¨ pull_request_target äº‹ä»¶æ—¶è¿è¡Œ
    if: github.event_name == 'pull_request_target'

    steps:
      # ğŸ”’ é‡è¦ï¼šä¸ checkout ä»»ä½•ä»£ç ï¼Œç‰¹åˆ«æ˜¯ PR ä»£ç ï¼
      # ğŸ”’ åªä½¿ç”¨ GitHub API è·å–å·¥ä½œæµè¿è¡Œç»“æœ

      - name: Wait for main check to complete
        uses: actions/github-script@v7
        id: wait-for-check
        with:
          script: |
            const { owner, repo } = context.repo;
            const headSha = context.payload.pull_request.head.sha;

            console.log(`ç­‰å¾… commit ${headSha} çš„æ£€æŸ¥å®Œæˆ...`);

            // ç­‰å¾…æœ€å¤š 10 åˆ†é’Ÿ
            const maxWaitTime = 10 * 60 * 1000; // 10 minutes
            const startTime = Date.now();

            while (Date.now() - startTime < maxWaitTime) {
              try {
                // è·å– commit çš„æ‰€æœ‰ check runs
                const { data: checkRuns } = await github.rest.checks.listForRef({
                  owner,
                  repo,
                  ref: headSha,
                });
                
                // æŸ¥æ‰¾æˆ‘ä»¬çš„å‰ç«¯æ£€æŸ¥å·¥ä½œæµ
                const frontendCheck = checkRuns.check_runs.find(run => 
                  run.name === 'Frontend Code Quality Check'
                );
                
                if (frontendCheck) {
                  console.log(`å‘ç°æ£€æŸ¥: ${frontendCheck.name}, çŠ¶æ€: ${frontendCheck.status}`);
                  
                  if (frontendCheck.status === 'completed') {
                    console.log(`æ£€æŸ¥å®Œæˆï¼Œç»“è®º: ${frontendCheck.conclusion}`);
                    return {
                      completed: true,
                      conclusion: frontendCheck.conclusion,
                      details_url: frontendCheck.details_url
                    };
                  }
                }
                
                // ç­‰å¾… 30 ç§’åé‡è¯•
                await new Promise(resolve => setTimeout(resolve, 30000));
              } catch (error) {
                console.log(`è·å–æ£€æŸ¥çŠ¶æ€æ—¶å‡ºé”™: ${error.message}`);
                await new Promise(resolve => setTimeout(resolve, 30000));
              }
            }

            // è¶…æ—¶æƒ…å†µ
            console.log('ç­‰å¾…è¶…æ—¶ï¼Œä½¿ç”¨é»˜è®¤å€¼');
            return {
              completed: false,
              conclusion: 'timed_out',
              details_url: null
            };

      - name: Comment on PR
        uses: actions/github-script@v7
        with:
          script: |
            const checkResult = ${{ steps.wait-for-check.outputs.result }};
            const prNumber = context.payload.pull_request.number;

            let emoji, statusEn, statusCn, conclusion;

            if (!checkResult.completed) {
              emoji = 'â°';
              statusEn = 'In Progress';
              statusCn = 'è¿›è¡Œä¸­';
              conclusion = 'pending';
            } else {
              switch(checkResult.conclusion) {
                case 'success':
                  emoji = 'âœ…';
                  statusEn = 'Passed';
                  statusCn = 'é€šè¿‡';
                  conclusion = 'success';
                  break;
                case 'failure':
                  emoji = 'âŒ';
                  statusEn = 'Failed';
                  statusCn = 'å¤±è´¥';
                  conclusion = 'failure';
                  break;
                default:
                  emoji = 'âš ï¸';
                  statusEn = 'Unknown';
                  statusCn = 'æœªçŸ¥';
                  conclusion = 'neutral';
              }
            }

            // æ„å»ºä¸­æ–‡æŠ¥å‘Š
            let chineseReport = `### ä¸­æ–‡æŠ¥å‘Š\n\n`;

            if (!checkResult.completed) {
              chineseReport += `**â° çŠ¶æ€:** å‰ç«¯ä»£ç è´¨é‡æ£€æŸ¥æ­£åœ¨è¿›è¡Œä¸­ï¼Œè¯·ç¨å€™æŸ¥çœ‹ç»“æœã€‚`;
            } else if (checkResult.conclusion === 'success') {
              chineseReport += `**ğŸ‰ ç»“æœ:** å‰ç«¯ä»£ç è´¨é‡æ£€æŸ¥å…¨éƒ¨é€šè¿‡ï¼\n\n`;
              chineseReport += `**ğŸ“‹ æ£€æŸ¥é¡¹ç›®:**\n`;
              chineseReport += `- âœ… ä»£ç è§„èŒƒæ£€æŸ¥ (ESLint)\n`;
              chineseReport += `- âœ… ç±»å‹æ£€æŸ¥ (TypeScript)\n`;
              chineseReport += `- âœ… å•å…ƒæµ‹è¯•\n`;
              chineseReport += `- âœ… æ„å»ºæµ‹è¯•`;
            } else if (checkResult.conclusion === 'failure') {
              chineseReport += `**âš ï¸ éœ€è¦å…³æ³¨:** å‘ç°éœ€è¦ä¿®å¤çš„é—®é¢˜ï¼Œè¯·æŸ¥çœ‹è¯¦ç»†æ—¥å¿—ã€‚\n\n`;
              chineseReport += `ç‚¹å‡»ä¸‹æ–¹é“¾æ¥æŸ¥çœ‹è¯¦ç»†æ£€æŸ¥ç»“æœã€‚`;
            } else {
              chineseReport += `**â„¹ï¸ çŠ¶æ€:** æ£€æŸ¥çŠ¶æ€å¼‚å¸¸ï¼Œè¯·æ£€æŸ¥å·¥ä½œæµé…ç½®ã€‚`;
            }

            // æ„å»ºè‹±æ–‡æŠ¥å‘Š
            let englishReport = `### English Report\n\n`;

            if (!checkResult.completed) {
              englishReport += `**â° Status:** Frontend code quality check is in progress, please wait for results.`;
            } else if (checkResult.conclusion === 'success') {
              englishReport += `**ğŸ‰ Result:** All frontend code quality checks passed!\n\n`;
              englishReport += `**ğŸ“‹ Check Items:**\n`;
              englishReport += `- âœ… Code Standards (ESLint)\n`;
              englishReport += `- âœ… Type Check (TypeScript)\n`;
              englishReport += `- âœ… Unit Tests\n`;
              englishReport += `- âœ… Build Test`;
            } else if (checkResult.conclusion === 'failure') {
              englishReport += `**âš ï¸ Attention Required:** Issues found that need to be fixed. Please check the detailed logs.\n\n`;
              englishReport += `Click the link below to view detailed check results.`;
            } else {
              englishReport += `**â„¹ï¸ Status:** Check status is abnormal, please check workflow configuration.`;
            }

            // ç»„åˆæœ€ç»ˆå†…å®¹
            let body = `## ğŸ¨ Frontend Code Quality Check ${statusEn} ${emoji}\n\n`;
            body += `**PR #${prNumber}** frontend code check completed.\n\n`;
            body += `${chineseReport}\n\n---\n\n${englishReport}`;

            // å¦‚æœæœ‰è¯¦ç»†é“¾æ¥ï¼Œæ·»åŠ åˆ°æŠ¥å‘Šä¸­
            if (checkResult.details_url) {
              body += `\n\n**ğŸ”— View Details:** [Click here to see the full check results](${checkResult.details_url})`;
            }

            // æŸ¥æ‰¾å¹¶æ›´æ–°ç°æœ‰è¯„è®º
            const { data: comments } = await github.rest.issues.listComments({
              owner: context.repo.owner,
              repo: context.repo.repo,
              issue_number: prNumber,
            });

            const botComment = comments.find(comment => 
              comment.user.type === 'Bot' && 
              comment.body.includes('ğŸ¨ Frontend Code Quality Check')
            );

            if (botComment) {
              await github.rest.issues.updateComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                comment_id: botComment.id,
                body: body
              });
              console.log('å·²æ›´æ–°ç°æœ‰çš„ PR è¯„è®º');
            } else {
              await github.rest.issues.createComment({
                owner: context.repo.owner,
                repo: context.repo.repo,
                issue_number: prNumber,
                body: body
              });
              console.log('å·²åˆ›å»ºæ–°çš„ PR è¯„è®º');
            }
